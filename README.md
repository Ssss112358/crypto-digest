# crypto-digest

This project summarizes Telegram channel discussions and posts them to Discord.

## Overview

This tool fetches messages from specified Telegram channels over the last 24 hours, analyzes them using the Gemini API, and posts a summary to a Discord webhook. The summary includes:

-   **Overall 24h Summary**: A high-level summary of the discussions in the last 24 hours.
-   **Recent Delta**: New topics, updates, and deadlines from the most recent 6 hours.

The process is designed to be run automatically every 6 hours using GitHub Actions.

## Project Structure

```
crypto-digest/
├─ .github/
│  └─ workflows/
│     └─ digest.yml              # 6時間ごと実行
├─ src/
│  ├─ telegram_pull.py           # Telethonで24h収集
│  ├─ bundler.py                 # 会話バンドル化（文脈付与）
│  ├─ ai/
│  │  ├─ analysis.py             # Gemini API呼び出し＋JSON修復
│  │  ├─ prompts.py              # 24h総括＋6h差分の複合プロンプト
│  │  └─ json_utils.py           # strip_code_fences / safe_json_loads
│  ├─ delivery/
│  │  └─ discord.py              # Webhook投稿
│  └─ render/
│     └─ html_report.py          # (Optional) HTML report generation
├─ scripts/
│  ├─ run_digest_job.py          # Main script
│  └─ gen_string_session.py      # To generate Telethon string session
├─ state/                        # Execution state (ignored by git)
├─ requirements.txt
├─ .gitignore
└─ README.md
```

## Setup

1.  Create a **Private** GitHub repository named `crypto-digest`.
2.  Populate the repository with the files from this project.
3.  Set the following secrets in your repository's **Settings > Secrets and variables > Actions**:
    *   `TG_API_ID`: Your Telegram API ID from my.telegram.org.
    *   `TG_API_HASH`: Your Telegram API Hash from my.telegram.org.
    *   `TG_STRING_SESSION`: Generated by running `python scripts/gen_string_session.py` locally.
    *   `GOOGLE_API_KEY`: Your Gemini API Key.
    *   `DISCORD_WEBHOOK_URL`: Your Discord Incoming Webhook URL.
4.  Trigger the workflow manually from the **Actions** tab to verify the setup. It will then run automatically every 6 hours.
